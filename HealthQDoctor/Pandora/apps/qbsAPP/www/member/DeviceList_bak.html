<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>设备绑定列表</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/lib/mui.min.css">
		<style>
			[v-cloak]{ display: none; }
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
		</style>
	</head>

	<body>


		<div class="mui-content">
			

		
			<div class="title">
				OTC十参数监测设备
			</div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('0')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							血糖分析仪
							<p class='mui-ellipsis'>监测血糖.</p>
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('1')">
					<a class='mui-navigate-right' href="javascript:;">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							血压计
							<p class='mui-ellipsis'>监测血压.</p>
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('2')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							体温计
							<p class='mui-ellipsis'>监测体温</p>
						</div>
					</a>
				</li>
					<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('3')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							血氧仪
							<p class='mui-ellipsis'>监测血氧</p>
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('4')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							血脂仪
							<p class='mui-ellipsis'>监测血脂</p>
						</div>
					</a>
				</li>
				
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('5')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							体重仪
							<p class='mui-ellipsis'>监测体重</p>
						</div>
					</a>
				</li>
				
					<li class="mui-table-view-cell mui-media" onclick="BindDeviceBluOtc('6')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/sblogo.jpg">
						<div class="mui-media-body">
							尿酸仪
							<p class='mui-ellipsis'>监测尿酸</p>
						</div>
					</a>
				</li>			
			</ul>
			<div class="title">
				其它智能设备
			</div>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell mui-media">
					<a class="mui-navigate-right" href="javascript:clickedNoHead('StepIndex.html','StepIndex.html','slide-in-left');">
						<img class="mui-media-object mui-pull-left" src="../img/lexin.jpg">
						<div class="mui-media-body">
							乐心手环
							<p class='mui-ellipsis'>记步监测睡眠.</p>
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media" onclick="BindDeviceWiFiLx('0')">
					<a class="mui-navigate-right">
						<img class="mui-media-object mui-pull-left" src="../img/lexin.jpg">
						<div class="mui-media-body">
							乐心血压计i5/i5s
							<p class='mui-ellipsis'>监测血压.</p>
						</div>
					</a>
				</li>




			</ul>

	</body>
<script src="../js/lib/mui.min.js" type="text/javascript"></script>
<script src="../js/base.js" type="text/javascript"></script>
<script src="../js/public.js" type="text/javascript"></script>

<script>
	
	


var username=null;  

function plusReady() { 
var objuser=JSON.parse(plus.storage.getItem('user'));
username = objuser.UserName;
HeadShow();

BindDeviceReady();

back();
}

if(window.plus){  
plusReady();  
}else{  
document.addEventListener("plusready",plusReady,false);  
} 
	
	
		
function BindDeviceReady(){

// 声明的JS“扩展插件别名”
    var _BARCODE = 'plugintest',
        B = window.plus.bridge;
    var plugintest =
{
    	PluginTestFunction : function (Argus1, Argus2, successCallback, errorCallback )
		{
			var success = typeof successCallback !== 'function' ? null : function(args)
			{
				successCallback(args);
			},
			fail = typeof errorCallback !== 'function' ? null : function(code)
			{
				errorCallback(code);
			};
			callbackID = B.callbackId(success, fail);

			return B.exec(_BARCODE, "PluginTestFunction", [callbackID, Argus1, Argus2]);
		},
         // 声明同步返回方法
        PluginTestFunctionSync : function (Argus1, Argus2, Argus3, Argus4)
        {
            // 通知Native层plugintest扩展插件运行“PluginTestFunctionSync”方法并同步返回结果
            return B.execSync(_BARCODE, "PluginTestFunctionSync", [Argus1, Argus2, Argus3, Argus4]);
        }
    };
    window.plus.plugintest = plugintest;
};


function BindDeviceBluOtc(Tval){
	
	 var Intent = plus.android.importClass("android.content.Intent");
	 var Bundle = plus.android.importClass("android.os.Bundle");
	 var main = plus.android.runtimeMainActivity();
	 var TodoActivity =plus.android.importClass("com.cnnet.otc.health.activities.DetectBle3Activity");
	
	 TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle3Activity");
		//血氧蓝牙4.0设备
		if(Tval =='0'){
			TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle2Activity");
		}
		if(Tval =='3'){
			TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle4Activity");
		}
		
		var intent = new Intent(main, TodoActivity.class);
		var bundle = new Bundle();
		//传设备类型和会员号
		bundle.putString("DEIVCE_TYPE",Tval);
		bundle.putString("EXTRA_MEMBER_UNIQUEKEY",username);
		intent.putExtras(bundle);
		main.startActivity(intent);

}


function BindDeviceBluLx(Tval){
	
	showPrompt();
}


function BindDeviceWiFiLx(Tval){
	
var Intent = plus.android.importClass("android.content.Intent");
var Bundle = plus.android.importClass("android.os.Bundle");
var main = plus.android.runtimeMainActivity();
var TodoActivity =plus.android.importClass("com.foxchen.qbs.health.activities.DetectWifiGuideActivity");
var intent = new Intent(main, TodoActivity.class);
var bundle = new Bundle();
	//传设备类型和会员号
bundle.putString("DEIVCE_TYPE",Tval);
bundle.putString("EXTRA_MEMBER_UNIQUEKEY",username);
intent.putExtras(bundle);
main.startActivity(intent);
}





function startActivity(type)
{
           var Intent = plus.android.importClass("android.content.Intent");
           var Bundle = plus.android.importClass("android.os.Bundle");
           var main = plus.android.runtimeMainActivity();
           var TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle3Activity");
           //血氧蓝牙4.0设备
           if(type=='0'){
             TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle2Activity");
           }
           if(type=='3'){
             TodoActivity = plus.android.importClass("com.cnnet.otc.health.activities.DetectBle4Activity");
           }
           var intent = new Intent(main, TodoActivity.class);
		   var bundle = new Bundle();
		   //传设备类型和会员号
		   bundle.putString("DEIVCE_TYPE",type);
		   bundle.putString("EXTRA_MEMBER_UNIQUEKEY",username);
           intent.putExtras(bundle);
			main.startActivity(intent);
}



function pluginShow(sn) {
			plus.nativeUI.showWaiting("正在连接设备...请稍等!");
			plus.plugintest.PluginTestFunction(sn,username,
				function(res){
					if(res == "0"){
						plus.nativeUI.toast("设备连接成功.",{duration:"long"});
						 plus.nativeUI.closeWaiting();
						clicked('StepIndex.html',true);
					}
					if(res == "1"){
						plus.nativeUI.toast("根据SN,未获取到设备注册信息.",{duration:"long"});
						plus.nativeUI.closeWaiting();
					}
					if(res == "2"){
						plus.nativeUI.toast("未找到设备!",{duration:"long"});
						plus.nativeUI.closeWaiting();
					}
					if(res == "3"){
						plus.nativeUI.toast("数据未同步到云端!",{duration:"long"});
						plus.nativeUI.closeWaiting();
					}
					if(res == "4"){
						//未开通蓝牙跳转到系统开通蓝牙界面
						plus.nativeUI.toast("未开通蓝牙!",{duration:"long"});
						plus.nativeUI.closeWaiting();

					}
					if(res == "5"){
						plus.nativeUI.alert("蓝牙设备不支持4.0");
						plus.nativeUI.closeWaiting();
					}
					if(res == "-1"){
						plus.nativeUI.alert("未找到设备!");
						plus.nativeUI.closeWaiting();
					}
				},
				function(result){
					alert("fail:"+result);
					plus.nativeUI.closeWaiting();
				});
}

function pluginGetString(sn)
        {
        	plus.nativeUI.showWaiting("正在连接设备...请稍等!");
        	var res=plus.plugintest.PluginTestFunctionSync(sn,username);
        	//返回几种情况 0 成功同步到云端 1 根据SN 未获取到Mac 2  未找到设备 3 未同步到云端 4、未开通蓝牙 5、蓝牙设备不支持4.0
        	plus.nativeUI.toast("返回结果："+res,{duration:"long"});
        	if(res == "0"){
        		plus.nativeUI.toast("成功同步到云端!",{duration:"long"});
        		 plus.nativeUI.closeWaiting();
				clicked('StepIndex.html',true);
        	}
        	if(res == "1"){
        		plus.nativeUI.toast("根据SN 未获取到Mac!",{duration:"long"});
        		plus.nativeUI.closeWaiting();
        	}
        	if(res == "2"){
        		plus.nativeUI.toast("未找到设备!",{duration:"long"});
        		 plus.nativeUI.closeWaiting();
        	}
        	if(res == "3"){
        		plus.nativeUI.toast("数据未同步到云端!",{duration:"long"});
        		 plus.nativeUI.closeWaiting();
        	}
        	if(res == "4"){
        		//未开通蓝牙跳转到系统开通蓝牙界面
        		plus.nativeUI.toast("未开通蓝牙!",{duration:"long"});
        		 plus.nativeUI.closeWaiting();

        	}
        	if(res == "5"){
				plus.nativeUI.alert("蓝牙设备不支持4.0");
				plus.nativeUI.closeWaiting();
        	}
			if(res == "-1"){
				plus.nativeUI.alert("未找到设备!");
				plus.nativeUI.closeWaiting();
			}
        }

		function showPrompt(){
			var bts=["现在连接","暂不连接"];
			plus.nativeUI.prompt("请输入设备序列号(SN)",function(e){
			var i=e.index;
			if(i=="0"){
				   //确定
				    if(e.value == ""){
				       plus.nativeUI.toast("序列号输入格式不正确",{duration:"long"});
				    }else{
				    	//e.value="0301570101062540";
				    	pluginShow(e.value);
				    }

				}else{
				  //取消
				  clicked('StepIndex.html','StepIndex.html','slide-in-right');
				}
				outLine( "按\""+((i>=0)?bts[e.index]:"返回")+"\"关闭："+e.value );
			},"","请输入序列号",bts);
		}

</script>
</html>