<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>个人管理中心</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/lib/mui.min.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.hBg{background:#E92F2F !important;}
            .hBg a {color: #E92F2F;}
        
			.mui-views,
			.mui-view,
			.mui-pages,
			.mui-page,
			.mui-page-content {
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
				background-color: #efeff4;
			}
			.mui-pages {
				top: 46px;
				height: auto;
			}
			.mui-scroll-wrapper,
			.mui-scroll {
				background-color: #efeff4;
			}
			.mui-page.mui-transitioning {
				-webkit-transition: -webkit-transform 300ms ease;
				transition: transform 300ms ease;
			}
			.mui-page-left {
				-webkit-transform: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
			}
			.mui-ios .mui-page-left {
				-webkit-transform: translate3d(-20%, 0, 0);
				transform: translate3d(-20%, 0, 0);
			}
			.mui-navbar {
				position: fixed;
				right: 0;
				left: 0;
				z-index: 10;
				height: 44px;
				background:#00CA11 !important;
			}
			.mui-navbar .mui-bar {
				position: absolute;
				background: transparent;
				text-align: center;
			}
			.mui-android .mui-navbar-inner.mui-navbar-left {
				opacity: 0;
			}
			.mui-ios .mui-navbar-left .mui-left,
			.mui-ios .mui-navbar-left .mui-center,
			.mui-ios .mui-navbar-left .mui-right {
				opacity: 0;
			}
			.mui-navbar .mui-btn-nav {
				-webkit-transition: none;
				transition: none;
				-webkit-transition-duration: .0s;
				transition-duration: .0s;
			}
			.mui-navbar .mui-bar .mui-title {
				display: inline-block;
				width: auto;
			}
			.mui-page-shadow {
				position: absolute;
				right: 100%;
				top: 0;
				width: 16px;
				height: 100%;
				z-index: -1;
				content: '';
			}
			.mui-page-shadow {
				background: -webkit-linear-gradient(left, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
				background: linear-gradient(to right, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
			}
			.mui-navbar-inner.mui-transitioning,
			.mui-navbar-inner .mui-transitioning {
				-webkit-transition: opacity 300ms ease, -webkit-transform 300ms ease;
				transition: opacity 300ms ease, transform 300ms ease;
			}
			.mui-page {
				display: none;
			}
			.mui-pages .mui-page {
				display: block;
			}
			.mui-page .mui-table-view:first-child {
				margin-top: 15px;
			}
			.mui-page .mui-table-view:last-child {
				margin-bottom: 30px;
			}
			.mui-table-view {
				margin-top: 20px;
			}
			
			.mui-table-view span.mui-pull-right {
				color: #999;
			}
			.mui-table-view-divider {
				background-color: #efeff4;
				font-size: 14px;
			}
			.mui-table-view-divider:before,
			.mui-table-view-divider:after {
				height: 0;
			}
			.head {
				height: 40px;
			}
			#head {
				line-height: 40px;
			}
			.head-img {
				width: 40px;
				height: 40px;
			}
			#head-img1 {
				position: absolute;
				bottom: 10px;
				right: 40px;
				width: 40px;
				height: 40px;
			}
			.update {
				font-style: normal;
				color: #999999;
				margin-right: -25px;
				font-size: 15px
			}
			.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			.mui-ios .mui-navbar .mui-bar .mui-title {
				position: static;
			}
			
			.mui-bar .mui-btn-link {color: #F7F7F7 !important;}
			.mui-title {
           font-size: 17px;
           font-weight: 800;
           line-height: 44px;
           position: absolute;
           display: block;
    width: 100%;
    margin: 0 -15px;
    padding: 0;
    text-align: center;
    white-space: nowrap;
    color: #F7F7F7;
}

          [v-cloak]{ display: none; }


		</style>
	</head>

	<body class="mui-fullscreen">
	 <div  id="bodyinfo">
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="setting" class="mui-page">
			<!--页面标题栏开始-->
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>
				</button>
				<h1 class="mui-center mui-title" id="headtitle">个人管理中心</h1>
			</div>
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell mui-media">
								<a class="mui-navigate-right" href="#account">
									<img class="mui-media-object mui-pull-left head-img" id="head-img" src="">
									<div class="mui-media-body">
										<span id="nickname"></span>
										<p class='mui-ellipsis' id="loginname">账号:</p>
									</div>
								</a>
							</li>
						</ul>
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a href="#account" class="mui-navigate-right">基本资料</a>
							</li>
						</ul>
						
						<!--<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a id="createGroup"  class="mui-navigate-right">创建社区</a>
							</li>
							
							<li class="mui-table-view-cell">
								<a id="fileUpload"  class="mui-navigate-right">病历上传</a>
							</li>
							
							<li class="mui-table-view-cell">
								<a id="question"  class="mui-navigate-right">健康问卷</a>
							</li>
							
							<li class="mui-table-view-cell">
								<a id="myReport"  class="mui-navigate-right">健康报告</a>
							</li>
							
						</ul>-->
						
						<ul class="mui-table-view mui-table-view-chevron" id="MemberMange" style="display: none;">
							<li class="mui-table-view-cell">
								<a href="#spread" class="mui-navigate-right">客户管理 </a>
							</li>
							<!--<li class="mui-table-view-cell">
								<a id="myFriend" class="mui-navigate-right">我的朋友圈 </a>
							</li>-->
						</ul>
						
						<ul class="mui-table-view mui-table-view-chevron">
							<!--<li class="mui-table-view-cell">
								
								<a href="#notifications" class="mui-navigate-right">新消息通知</a>
							</li>-->
							<li class="mui-table-view-cell">
								<a href="#privacy" class="mui-navigate-right">隐私</a>
							</li>
							<li class="mui-table-view-cell">
								<a href="#general" class="mui-navigate-right">通用</a>
							</li>
						</ul>
						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a href="#about" class="mui-navigate-right">关于健康Q博士 <i class="mui-pull-right update">V2.0</i></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell" style="text-align: center;">
								<a id="logout">退出登录</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>
		<!--单页面结束-->
		<div id="account" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">账号与安全</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a id="head" class="mui-navigate-right">头像
								<span class="mui-pull-right head">
									<img class="head-img mui-action-preview" id="head-img1" src=""/>
								</span>
							</a>
							</li>
							<li class="mui-table-view-cell">
								<a>姓名<span class="mui-pull-right" id="realname"></span></a>
							</li>
							<li class="mui-table-view-cell">
								<a>账号<span class="mui-pull-right" id="username"></span></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a>性别<span class="mui-pull-right" id="sex">男</span></a>
							</li>
							<li class="mui-table-view-cell">
								<a>生日<span class="mui-pull-right" id="birthdate"></span></a>
							</li>
							<li class="mui-table-view-cell">
								<a>所在地区<span class="mui-pull-right" id="area"></span></a>
							</li>
						</ul>
						
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a id="EditPerInfo"  class="mui-navigate-right">资料完善修改</a>
							</li>
							

						</ul>
						
					</div>
				</div>
			</div>
		</div>
		<div id="notifications" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">新消息通知</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a>接收新消息通知<span class="mui-pull-right">已开启</span></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								通知显示消息详情
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
						</ul>
						<div class="mui-content-padded">
							<p>若关闭，当收到新消息时，通知提示将不显示发信人和内容摘要</p>
						</div>

						<ul class="mui-table-view mui-table-view-chevron">
							<li class="mui-table-view-cell">
								<a href="#notifications_disturb" class="mui-navigate-right">功能消息免打扰</a>
							</li>
						</ul>
						<div class="mui-content-padded">
							<p>设置系统功能消息提示声音和震动的时段</p>
						</div>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a>接收新消息通知<span class="mui-pull-right">已开启</span></a>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								声音
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
							<li class="mui-table-view-cell">
								震动
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
						</ul>
						<div class="mui-content-padded">
							<p>当健康Q博士在运行时，你可以设置是否需要声音或者震动</p>
						</div>
						<div></div>
					</div>
				</div>
			</div>
		</div>
		<div id="notifications_disturb" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>新消息通知
				</button>
				<h1 class="mui-center mui-title">功能消息免打扰</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view mui-table-view-radio">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">开启</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">只在夜间开启</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">关闭</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div id="privacy" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">隐私</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-divider">通讯录</li>
							<li class="mui-table-view-cell">
								加我为朋友时需要验证
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								向我推荐QQ好友
								<div class="mui-switch mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
							<li class="mui-table-view-cell">
								通过QQ号搜索到我
								<div class="mui-switch mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								可通过手机号搜索到我
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
							<li class="mui-table-view-cell">
								向我推荐通讯录朋友
								<div class="mui-switch mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
							<li class="mui-table-view-divider">开启后，为你推荐已经开通健康Q博士账号的手机联系人</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								通过健康Q博士账号搜索到我
								<div class="mui-switch mui-active mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
							<li class="mui-table-view-divider">关闭后，其他用户将不能通过健康Q博士账号搜索到你</li>
						</ul>

					</div>
				</div>
			</div>
		</div>
		<div id="general" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">通用</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								多语言
							</li>
						</ul>

						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								听筒模式
								<div class="mui-switch mui-switch-mini">
									<div class="mui-switch-handle"></div>
								</div>
							</li>
						</ul>
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								功能
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		
		
		<div id="spread" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">客户管理</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							
							<!--<li class="mui-table-view-cell mui-plus-visible">
								<a id="share" class="mui-navigate-right">分享推荐</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="tel" class="mui-navigate-right">客服电话</a>
							</li>-->
							<li class="mui-table-view-cell">
								<a href="javascript:GotoSales();" class="mui-navigate-right">客户管理</a>
							</li>
							<li class="mui-table-view-cell">
								<a href="javascript:clicked('RegMember.html','RegMember.html','slide-in-right','注册新客户');" class="mui-navigate-right">注册新客户</a>
							</li>
							<li class="mui-table-view-cell">
								<a href="javascript:clicked('CardIntroduce.html','CardIntroduce.html','slide-in-right','服务卡介绍');" class="mui-navigate-right">产品清单</a>
							</li>
							
						</ul>
					</div>
				</div>
			</div>
		</div>
		

		<div id="about" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>设置
				</button>
				<h1 class="mui-center mui-title">关于健康Q博士</h1>
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<!--<li class="mui-table-view-cell mui-plus-visible">
								<a id="rate" class="mui-navigate-right">评分鼓励</a>
							</li>
							<li class="mui-table-view-cell mui-plus-visible">
								<a id="welcome" class="mui-navigate-right">欢迎页</a>
							</li>-->
							
							<li class="mui-table-view-cell">
								<a id="feedback-btn" href="#feedback" class="mui-navigate-right">问题反馈</a>
							</li>
							<li class="mui-table-view-cell">
								<a id="update" class="mui-navigate-right">检查更新</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		<div id="feedback" class="mui-page feedback">
			<div class="mui-navbar-inner mui-bar mui-bar-nav hBg">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>关于健康Q博士
				</button>
				<h1 class="mui-center mui-title">问题反馈</h1>
			</div>
			<div class="mui-page-content">
				<p>问题和意见</p>
				<div class="row mui-input-row">
					<textarea id='question' class="mui-input-clear question" placeholder="请详细描述你的问题和意见..."></textarea>
				</div>
				<p>图片(选填,提供问题截图)</p>
				<div id='image-list' class="row image-list">
				</div>
				<p>QQ/邮箱</p>
				<div class="mui-input-row">
					<input id='contact' type="text" class="mui-input-clear  contact" placeholder="(选填,方便我们联系你 )" />
				</div>
				<button id='submit' type="button" class="mui-btn mui-btn-green">提交</button>
			</div>
			<p>基于环信 “WebIM SDK” + 环信 “移动客服” 实现，在环信 “移动客服面板” 能够查阅反馈信息。</p>
		</div>
	 </div>
	</body>
	<script src="../js/lib/jquery-2.1.3.min.js"></script>
	<script src="../js/public.js" type="text/javascript"></script>
	<script src="../js/base.js" type="text/javascript"></script>
	<script src="../js/lib/mui.min.js"></script>
    <script src="../js/lib/mui.view.js"></script>
    <script src="../js/lib/axios.min.js"></script>
    <script src="../js/lib/qs.js"></script>
	<script>
	
			mui.init({
				swipeBack: false,
				statusBarBackground: '#f7f7f7',
				gestureConfig: {
					doubletap: true
				}
			});


		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#setting'
		});
		
		
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();

	
		var view = viewApi.view;
		(function($) {
			//处理view的后退与webview后退
			var oldBack = $.back;
			$.back = function() {
				if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
					viewApi.back();
				} else { //执行webview后退
					oldBack();
				}
			};
			//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
			//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
			view.addEventListener('pageBeforeShow', function(e) {
				//				console.log(e.detail.page.id + ' beforeShow');
			});
			view.addEventListener('pageShow', function(e) {
				//				console.log(e.detail.page.id + ' show');
			});
			view.addEventListener('pageBeforeBack', function(e) {
				//				console.log(e.detail.page.id + ' beforeBack');
			});
			view.addEventListener('pageBack', function(e) {
				//				console.log(e.detail.page.id + ' back');
			});
		})(mui);


var httpUrl=GetHttpApi(); 
var domainUrl = GetMvcApiDomain();
var username = null;
var UserRole=null;
var UserRoleName = null;
var wgtVer=null;


if (window.plus && plus.networkinfo.getCurrentType()==plus.networkinfo.CONNECTION_WIFI) {
    plusReady();
} else {
    document.addEventListener('plusready', plusReady, false);
}

function plusReady() {
 
var objuser=JSON.parse(plus.storage.getItem('user'));
username = objuser.UserName;
UserRole = objuser.UserRole;
UserRoleName = objuser.UserRoleName;


if (UserRole>=1){
	 document.getElementById('MemberMange').style.display="";
}

getPerInfo(username);

    plus.runtime.getProperty(plus.runtime.appid, function(inf) {
        wgtVer = inf.version;
        console.log("当前应用版本：" + wgtVer);
        //checkUpdate();
    });

}




//username='13971139503';
//getPerInfo(username);

   //向后台获取个人数据
function getPerInfo(username) {

                var that = this;
            	
                axios.get(domainUrl +'api/MemberOperate/getUserInfoByCode', {
                params: {
                UserName: username
                 }
                })
                .then(function (response) {
                  	if(response.data.code=='200'){
                    var sexval="男";
                	if (response.data.sex==1){
                		sexval="男";
                	}
                	else{
                		sexval="女";
                	}
                	
                	document.getElementById('headtitle').innerHTML=response.data.RoleName+"管理中心";
                    document.getElementById('nickname').innerHTML=response.data.NickName;
                    document.getElementById('loginname').innerHTML="账号："+username;
                    document.getElementById('head-img').src=response.data.HeadPic;
                    document.getElementById('head-img1').src=response.data.HeadPic;
                    document.getElementById('realname').innerHTML=response.data.ReallyName;
                    document.getElementById('username').innerHTML=username;
                    document.getElementById('sex').innerHTML=sexval;
                    document.getElementById('area').innerHTML=response.data.Province+response.data.City;
                    document.getElementById('birthdate').innerHTML=response.data.Birthday;

                  	}
                  	else
                  	{
                  		mui.toast(response.data.code);
                  	}
                  	
                 })
                .catch(function (response) {
                  //console.log(response);
                  mui.toast(response);
                 });

};	


		//更换头像
mui(".mui-table-view-cell").on("tap", "#head", function(e) {
			if(mui.os.plus){
				var a = [{
					title: "拍照"
				}, {
					title: "从手机相册选择"
				}];
				plus.nativeUI.actionSheet({
					title: "修改头像",
					cancel: "取消",
					buttons: a
				}, function(b) {
					switch (b.index) {
						case 0:
							break;
						case 1:
							getImage();
							break;
						case 2:
							galleryImg();
							break;
						default:
							break
					}
				})	
			}
			
});


function getImage() {  
            var cmr = plus.camera.getCamera();  
            cmr.captureImage(function(p) {  
                    plus.io.resolveLocalFileSystemURL(p, function(entry) {  
                            var path = entry.toLocalURL();  
                            
                            //picIndex += 1;  
                            appendFile(path); //处理图片的地方  
                            setTimeout("upload(1)", 1000);  
                        },  
                        function(e) {  
                            mui.toast("读取拍照文件错误：" + e.message);  
                        });  
                },  
                function(e) {  
                    //                  alert("失败：" + e.message);  
                }, {  
                    filename: "_doc/camera/",  
                    index: 1  
                });  
}


function galleryImg() {  
    plus.gallery.pick(function(path) {  
        
        //picIndex += 1;  
        appendFile(path); //处理图片的地方  
        setTimeout("upload(2)", 1000);
    }, function(e) {  
        console.log("取消选择图片");  
    }, {  
        filter: "none",  
        system: false  
    });  
}



var f1=null;
function appendFile(path) {  
            var img = new Image();  
            img.src = path; // 传过来的图片路径在这里用。  
            img.onload = function() {  
                var that = this;  
                //生成比例   
                var w = that.width,  
                    h = that.height,  
                    scale = w / h;  
                w = 60 || w; //480  你想压缩到多大，改这里  
                h = w / scale;  
                //生成canvas  
                var canvas = document.createElement('canvas');  
                var ctx = canvas.getContext('2d');  
                $(canvas).attr({  
                    width: w,  
                    height: h  
                });  
                ctx.drawImage(that, 0, 0, w, h);  
                var base64 = canvas.toDataURL('image/jpeg', 1 || 1); //1最清晰，越低越模糊。  
                f1 = base64;  
            }  
}

var server=domainUrl+"/FileUpload/PerHeadPicUpload";

function upload(index) { 
	        var wt=plus.nativeUI.showWaiting();
            var url = server;  
            var dataType = 'json';  
            //发送数据    
            var data = {  
                base64File: f1, //base64数据  
                index: index  
            };  
            
            $.ajax({
            url : server,
            type : "post",
            data : data,
            success : function(result) {
                
                SaveHeadImage(username,result);
            },
            error : function() {
                mui.toast("网络错误,请稍后再试!");;
            }
        });
        plus.nativeUI.closeWaiting();
        
}

function SaveHeadImage(username,filename){   
     $.ajax({
      url: domainUrl + "api/MemberOperate/getPerHeadPicSave",
      type: 'get',
      dataType: "json",
      data: {UserName:username,FileName:filename},
      success: function (data) {
      if (data.code='200'){
      getPerInfo(username);
      }
      else{
      mui.toast("图片上传出错，请稍后再试");	
      }
    },
    error: function () {
     mui.toast("网络错误，请稍后再试");
   }
 });
}

document.getElementById("head-img1").addEventListener('tap', function(e) {
	initImgPreview();
});

		function initImgPreview() {
			var imgs = document.querySelectorAll("img.mui-action-preview");
			imgs = mui.slice.call(imgs);
			if (imgs && imgs.length > 0) {
				var slider = document.createElement("div");
				slider.setAttribute("id", "__mui-imageview__");
				slider.classList.add("mui-slider");
				slider.classList.add("mui-fullscreen");
				slider.style.display = "none";
				slider.addEventListener("tap", function() {
					slider.style.display = "none";
				});
				slider.addEventListener("touchmove", function(event) {
					event.preventDefault();
				})
				var slider_group = document.createElement("div");
				slider_group.setAttribute("id", "__mui-imageview__group");
				slider_group.classList.add("mui-slider-group");
				imgs.forEach(function(value, index, array) {
					//给图片添加点击事件，触发预览显示；
					value.addEventListener('tap', function() {
						slider.style.display = "block";
						_slider.refresh();
						_slider.gotoItem(index, 0);
					})
					var item = document.createElement("div");
					item.classList.add("mui-slider-item");
					var a = document.createElement("a");
					var img = document.createElement("img");
					img.setAttribute("src", value.src);
					a.appendChild(img)
					item.appendChild(a);
					slider_group.appendChild(item);
				});
				slider.appendChild(slider_group);
				document.body.appendChild(slider);
				var _slider = mui(slider).slider();
			}
}


			
		//检查更新
document.getElementById("update").addEventListener('tap', function() {
	plus.nativeUI.showWaiting("检测更新...");
	var appid=plus.runtime.appid;
	var version=plus.runtime.version;
	var imei=plus.device.imei;
//	var appid="123123";
//	var version="123123";
//	var imei="123123";
//mui.toast(version);
//mui.toast(wgtVer);
	
			var that = this;
            	
                axios.get(domainUrl +'api/AppSet/getCheckUpdate', {
                params: {
                appid: appid,
                version: wgtVer,
                imei: imei
                 }
                })
                .then(function (response) {
                  	plus.nativeUI.closeWaiting();
                   if (!response.data.status) {
                   	
                  //可以升级
                    plus.nativeUI.confirm("检查到当前版本有最新更新，下载升级？",
                        function(event){
                            if(event.index ==0){
                                console.log('下载地址：'+response.data.url)
                                downWgt(response.data.url); //下载更新版的地址
                            }                        
                        } ,'系统消息',['马上升级','下次再说']);
					    
					    
				    } 
				    
				    else {
					mui.toast('健康Q博士已是最新版本~')

                  	}
                  	
                  	
                 })
                .catch(function (response) {
                	plus.nativeUI.closeWaiting();
                  mui.toast('获取版本信息失败');
                 });
			
});	


// 下载wgt文件

function downWgt(wgtUrl){
    plus.nativeUI.showWaiting("下载更新文件...");
    plus.downloader.createDownload( wgtUrl, {filename:"_doc/update/"}, function(d,status){
        if ( status == 200 ) { 
            //console.log("下载wgt成功："+d.filename);
            installWgt(d.filename); // 安装wgt包
        } else {
            //console.log("下载wgt失败！");
            plus.nativeUI.alert("下载更新失败！");
        }
        plus.nativeUI.closeWaiting();
    }).start();
}

// 更新应用资源  
function installWgt(path){
    plus.nativeUI.showWaiting("安装更新文件...");
    plus.runtime.install(path,{},function(){
        plus.nativeUI.closeWaiting();        
        plus.nativeUI.alert("应用资源更新完成！",function(){
            plus.runtime.restart();
        });
    },function(e){
        plus.nativeUI.closeWaiting();        
        plus.nativeUI.alert("安装更新文件失败["+e.code+"]："+e.message);
    });
}

function GotoSales(){
	if(UserRole>=1 && UserRole!=6){
	clicked('ShopMemberList.html','ShopMemberList.html','slide-in-right','客户管理');
	}
	else{
	clicked('SalesMemberList.html','SalesMemberList.html','slide-in-right','客户管理');	
	}
}



document.getElementById("EditPerInfo").addEventListener('tap',function(){
clicked('EditPerInfo.html','EditPerInfo.html','slide-in-right','我的资料修改');
});






document.getElementById("logout").addEventListener('tap',function(){
 plus.storage.removeItem('user');
 plus.runtime.quit();
 //plus.runtime.restart();
 //plus.storage.clear();
 
//var all = plus.webview.all(); 
//var current = plus.webview.currentWebview().id; 
//for(var i=0,len=all.length;i<len;i++){
//	if(all[i].id!==current){
//      all[i].close(); 
//
//  } 
//} 

//for(var i=0,len=all.length;i<len;i++){
//	console.log("webview"+i+": "+all[i].getURL());
//}

 //clickedNoHead('../login.html','login.html','slide-in-right');



});


 






	</script>

</html>